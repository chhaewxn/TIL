## íšŒì› ê´€ë¦¬ ì˜ˆì œ - ë°±ì—”ë“œ ê°œë°œ
### ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ ì •ë¦¬
- ë°ì´í„°: íšŒì›ID, ì´ë¦„
- ê¸°ëŠ¥: íšŒì› ë“±ë¡, ì¡°íšŒ
- ì•„ì§ ë°ì´í„° ì €ì¥ì†Œê°€ ì„ ì •ë˜ì§€ ì•ŠìŒ(ê°€ìƒì˜ ì‹œë‚˜ë¦¬ì˜¤)

ğŸ”»ì¼ë°˜ì ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ êµ¬ì¡°
![](https://velog.velcdn.com/images/chhaewxn/post/f9af9603-41e3-469f-9ce9-3b5c9bda5bf2/image.png)

- ì»¨íŠ¸ë¡¤ëŸ¬: ì›¹ MVCì˜ ì»¨íŠ¸ë¡¤ëŸ¬ ì—­í• 
- ì„œë¹„ìŠ¤: í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„
- ë¦¬í¬ì§€í† ë¦¬: ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼, ë„ë©”ì¸ ê°ì²´ë¥¼ DBì— ì €ì¥í•˜ê³  ê´€ë¦¬
ë„ë©”ì¸: ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ê°ì²´, ì˜ˆ) íšŒì›, ì£¼ë¬¸, ì¿ í° ë“±ë“± ì£¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê³  ê´€ë¦¬ë¨

ğŸ”»í´ë˜ìŠ¤ ì˜ì¡´ê´€ê³„
![](https://velog.velcdn.com/images/chhaewxn/post/bfc8ca0f-bbdd-4dc3-821c-b802b1c7f19a/image.png)
- ì•„ì§ ë°ì´í„° ì €ì¥ì†Œê°€ ì„ ì •ë˜ì§€ ì•Šì•„ì„œ, ìš°ì„  ì¸í„°í˜ì´ìŠ¤ë¡œ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„
- ë°ì´í„° ì €ì¥ì†ŒëŠ” RDB, NoSQL ë“±ë“± ë‹¤ì–‘í•œ ì €ì¥ì†Œë¥¼ ê³ ë¯¼ì¤‘ì¸ ìƒí™©ìœ¼ë¡œ ê°€ì •
- ê°œë°œì„ ì§„í–‰í•˜ê¸° ìœ„í•´ì„œ ì´ˆê¸° ê°œë°œ ë‹¨ê³„ì—ì„œëŠ” êµ¬í˜„ì²´ë¡œ ê°€ë²¼ìš´ ë©”ëª¨ë¦¬ ê¸°ë°˜ì˜ ë°ì´í„° ì €ì¥ì†Œ ì‚¬ìš©

### íšŒì› ë„ë©”ì¸ê³¼ ë¦¬í¬ì§€í† ë¦¬ ë§Œë“¤ê¸°
ğŸ”»`íšŒì› ê°ì²´`
```java
package hello.hellospring.domain;
public class Member {

 private Long id;
 private String name;
 public Long getId() {
 return id;
 }
 public void setId(Long id) {
 this.id = id;
 }
 public String getName() {
 return name;
 }
 public void setName(String name) {
 this.name = name;
 }
}
```

ğŸ”»`íšŒì› ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤`
```java
package hello.hellospring.repository;
import hello.hellospring.domain.Member;
import java.util.List;
import java.util.Optional;
public interface MemberRepository {
 Member save(Member member);
 Optional<Member> findById(Long id);
 Optional<Member> findByName(String name);
 List<Member> findAll();
}
```

ğŸ”»`íšŒì› ë¦¬í¬ì§€í† ë¦¬ ë©”ëª¨ë¦¬ êµ¬í˜„ì²´`
```java
package hello.hellospring.repository;
import hello.hellospring.domain.Member;
import java.util.*;
/**
 * ë™ì‹œì„± ë¬¸ì œê°€ ê³ ë ¤ë˜ì–´ ìˆì§€ ì•ŠìŒ, ì‹¤ë¬´ì—ì„œëŠ” ConcurrentHashMap, AtomicLong ì‚¬ìš© ê³ ë ¤
 */
public class MemoryMemberRepository implements MemberRepository {
 private static Map<Long, Member> store = new HashMap<>();
 private static long sequence = 0L;
 @Override
 public Member save(Member member) {
 member.setId(++sequence);
 store.put(member.getId(), member);
 return member;
 }
 @Override
 public Optional<Member> findById(Long id) {
 return Optional.ofNullable(store.get(id));
 }
 @Override
 public List<Member> findAll() {
 return new ArrayList<>(store.values());
 }
 @Override
 public Optional<Member> findByName(String name) {
 return store.values().stream()
 .filter(member -> member.getName().equals(name))
 .findAny();
 }
 public void clearStore() {
 store.clear();
 }
}
```


### íšŒì› ë¦¬í¬ì§€í† ë¦¬ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±
- JUnit í”„ë ˆì„ì›Œí¬ë¡œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê°€ëŠ¥

ğŸ”»íšŒì› ë¦¬í¬ì§€í† ë¦¬ ë©”ëª¨ë¦¬ êµ¬í˜„ì²´ í…ŒìŠ¤íŠ¸
```java
package hello.hellospring.repository;
import hello.hellospring.domain.Member;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.Test;
import java.util.List;
import java.util.Optional;
import static org.assertj.core.api.Assertions.*;
class MemoryMemberRepositoryTest {
 MemoryMemberRepository repository = new MemoryMemberRepository();
 @AfterEach
 public void afterEach() {
 repository.clearStore();
 }
 @Test
 public void save() {
 //given
 Member member = new Member();
 member.setName("spring");
 //when
 repository.save(member);
 //then
 Member result = repository.findById(member.getId()).get();
 assertThat(result).isEqualTo(member);
 }
 @Test
 public void findByName() {
 //given
 Member member1 = new Member();
 member1.setName("spring1");
 repository.save(member1);
 Member member2 = new Member();
 member2.setName("spring2");
 repository.save(member2);
 //when
 Member result = repository.findByName("spring1").get();
 //then
 assertThat(result).isEqualTo(member1);
 }
 @Test
 public void findAll() {
 //given
 Member member1 = new Member();
 member1.setName("spring1");
 repository.save(member1);
 Member member2 = new Member();
 member2.setName("spring2");
 repository.save(member2);
 //when
 List<Member> result = repository.findAll();
 //then
 assertThat(result.size()).isEqualTo(2);
 }
}
```
- `@AfterEach`: í•œ ë²ˆì— ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ë©”ëª¨ë¦¬ DBì— ì§ì „ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ë‚¨ê¸°ì— ë‹¤ìŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨í•  ê°€ëŠ¥ì„±ì´ ìˆë‹¤. `@AfterEach`ë¥¼ ì‚¬ìš©í•˜ë©´ ê° í…ŒìŠ¤íŠ¸ê°€ ì¢…ë£Œë  ë•Œë§ˆë‹¤ ë©”ëª¨ë¦¬ DBì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ì‚­ì œ
- í…ŒìŠ¤íŠ¸ ìˆœì„œì— ì˜ì¡´ê´€ê²Œê°€ ìˆëŠ” ê²ƒì€ ì¢‹ì€ í…ŒìŠ¤íŠ¸ê°€ ì•„ë‹˜, ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ì•¼í•¨

### íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ
```java
package hello.hellospring.service;

import hello.hellospring.domain.Member;
import hello.hellospring.repository.MemberRepository;
import hello.hellospring.repository.MemoryMemberRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Optional;

public class MemberService {

    private final MemberRepository memberRepository;

    public MemberService(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    /***
     * íšŒì›ê°€ì…
     */
    public Long join(Member member) {

        validateDuplicateMember(member); // ì¤‘ë³µ íšŒì› ê²€ì¦
        memberRepository.save(member);
        return member.getId();
    }

    private void validateDuplicateMember(Member member){
        // ê°™ì€ ì´ë¦„ì´ ìˆëŠ” ì¤‘ë³µ íšŒì› X
        memberRepository.findByName(member.getName())
                .ifPresent(m -> {
                    throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
                });
    }

    /*
     * ì „ì²´ íšŒì› ì¡°íšŒ
     */
    public List<Member> findMembers(){
        return memberRepository.findAll();
    }

    public Optional<Member> findOne(Long memberId) {
        return memberRepository.findById(memberId);
    }
}
```

### íšŒì› ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸
```java
package hello.hellospring.service;

import hello.hellospring.domain.Member;
import hello.hellospring.repository.MemoryMemberRepository;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.*;
import static org.junit.jupiter.api.Assertions.*;

class MemberServiceTest {

    MemberService memberService;
    MemoryMemberRepository memberRepository = new MemoryMemberRepository();

    @BeforeEach
    public void beforeEach(){
        memberRepository = new MemoryMemberRepository();
        memberService = new MemberService(memberRepository);
    }

    @AfterEach
    public void afterEach(){
        memberRepository.clearStore();
    }

    @Test
    void íšŒì›ê°€ì…() {
        //given
        Member member = new Member();
        member.setName("hello");

        //when
        Long saveId = memberService.join(member);

        //then
        Member findMember = memberService.findOne(saveId).get();
        assertThat(member.getName()).isEqualTo(findMember.getName());
    }

    @Test
    public void ì¤‘ë³µ_íšŒì›_ì˜ˆì™¸(){
        //given
        Member member1 = new Member();
        member1.setName("spring");

        Member member2 = new Member();
        member2.setName("spring");

        //when
        memberService.join(member1);
        IllegalStateException e = assertThrows(IllegalStateException.class, () -> memberService.join(member2));

        assertThat(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");

        /*
        try{
            memberService.join(member2);
            fail();
        } catch (IllegalStateException e) {
           assertThat(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
        }
         */

        //then
    }

    @Test
    void findMembers() {
    }

    @Test
    void findOne() {
    }
}
```

- `@BeforeEach`: ê° í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ì— í˜¸ì¶œëœë‹¤. í…ŒìŠ¤íŠ¸ê°€ ì„œë¡œ ì˜í–¥ì´ ì—†ë„ë¡ í•­ìƒ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , ì˜ì¡´ ê´€ê³„ë„ ìƒˆë¡œ ë§ºì–´ì¤€ë‹¤.
