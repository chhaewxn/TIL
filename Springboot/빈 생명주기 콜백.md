## 📝 빈 생명주기 콜백
### 스프링 컨테이너의 생명주기

스프링 컨테이너 생성 ➡️ 빈 설정 ➡️ 사용 ➡️ 소멸 순서으로 구성

아래와 같은 방식으로 스프링 컨테이너에 대한 라이프사이클 메서드를 사용할 수 있다.

```java
AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(); 
	ac.register(); //빈 추가로 등록
	ac.referesh(); //등록하기 위한 갱신
	ac.close(); //소멸 메서드, 이때 빈도 같이 소멸
```

스프링 프로젝트가 시작될 때 DB연결, 소켓연결, 기타 등등 시간이 걸리기에 미리 연결을 한 뒤 애플리케이션 종료시점에 연결을 종료해야하는 경우 객체의 초기화 및 종료 작업을 해야 한다. 
(Ex: 커넥션 풀의 connect & disconnect)
그밖에 테스트 케이스 작성시 테스트 픽스처 준비를 하는경우에도 초기화 및 종료 작업을 해야한다. 

스프링 빈은 객체를 생성 후 의존관계를 주입한 뒤 사용할 준비가 완료된다. 내가 해당 빈에서 초기화 작업들을 해주고싶다면 이런 의존관계가 모두 주입된 다음 호출해야 한다. 개발자 입장에서 의존관계가 모두 주입이 완료되는 시점을 알기 위해서 스프링에서는 스프링 빈이 의존관계 주입이 완료되면 콜백 메서드를 통해 초기화 시점을 알려주는 기능을 제공한다. 더하여 스프링 컨테이너의 소멸 직전 소멸 콜백을 주어서 스프링 컨테이너가 종료되기 전 로직을 수행할 수 있다. (ex: DB와의 연결 종료)

- 초기화 콜백: 빈이 생성되고, 빈의 의존관계 주입이 완료된 후 호출
- 소멸전 콜백: 빈이 소멸되기 직전 호출


🔻 객체의 생성과 초기화를 분리하자.
: 생성자는 필수 정보를 받아 메모리 할당후 객체를 생성하는 책임을 가진다. 
그리고 초기화는 이렇게 생성된 값들을 활용해 기타 무거운 작업들을 수행한다. 그렇기에 생성과 초기화를 묶는 것은 SRP(단일 책임 원칙)적으로도 과한 책임을 가지게 되기에 명확하게 두 부분을 나누는 것이 유지 보수 관점 및 객체지향 프로그램 적으로도 좋다. 

: 싱글톤 빈들은 스프링 컨테이너가 종료될 때 같이 종료되기에 소멸전 콜백이 스프링 컨테이너 종료 직전 호출되지만, 생명주기가 더 짧은 빈들도 있는데 이 빈들은 컨테이너와 무관하게 소멸전 콜백이 일어난다. 

🔻 그럼 스프링은 빈 생명주기 콜백을 어떻게 관리하는가? 
- 인터페이스(InitializingBean, DisposableBean)
- 설정 정보에 초기화 메서드, 종료 메서드 지정(애노테이션 속성 설정)
- @PostConstructor, @PreDestroy 애노테이션 사용

### 인터페이스 initializingBean, DisposableBean
InitializingBean, DisposableBean 두 인터페이스를 가져와 사용해보자.

- InitializingBean은 afterPropertiesSet() 메서드로 초기화를 지원한다.
- DisposableBean은 destroy() 메서드로 소멸을 지원한다.
- 초기화가 메서드 의존관계 주입 완료 이후 호출되었기에 Null이 아닌 제대로 된 url이 출력된다.
- 스프링 컨테이너가 종료되는 시점에서 disconnect도 호출되는것을 확인할 수 있다. 

해당 인터페이스 두개를 구현하면서 두 메서드만 오버라이딩해서 구현하면되니 편하지만, 이 인터페이스는 스프링 전용 인터페이스이기 때문에 해당 인터페이스에 의존하게 된다. 
그리고 두 인터페이스에서 제공하는 메서드 오버라이딩이기 때문에 이름을 변경할 수 없고 외부 라이브러리에는 적용할수도 없다.


### 빈 등록 초기화, 소멸 메서드
스프링 빈 등록 애노테이션@Bean에 속성으로 초기화, 소멸 메서드를 지정할 수 있다. 

> @Bean(initMethod = "초기화메서드명", destroyMethod="소멸메서드명")

인터페이스를 사용하는 것과는 다르게 이름도 init, close로 개발자가 임의로 지정할 수 있고, 스프링 빈이 스프링 코드(인터페이스)에 의존하지 않는다. 그리고 코드가 아닌 설정 정보를 이용하기 때문에 외부 라이브러리를 사용할지라도 적용이 가능하다. 

#### 종료 메서드 추론
@Bean 애노테이션의 소멸메서드를 지정하는 속성인 destroyMethod 에는 추론기능이 있다. 

관례적으로 대부분 라이브러리에서는 close, shutdown 이라는 이름으로 소멸 메서드를 사용하기때문에, @Bean 의 destroyMethod는 default 값으로 (inferred)(추론)으로 등록되어 있는데, 이 기능은 close, shutdown이라는 이름의 메서드를 자동으로 호출해준다. 

즉, 내가 스프링 빈을 등록할때 종료 메서드를 해당 관례를 따르는 close나 shutdown으로 지정한다면 따로 속성에 destroyMethod에 지정해주지 않아도, 자동으로 찾아서 동작한다.

만약, 추론 기능을 사용하기 싫을경우 공백("")을 지정하면 된다.

### 애노테이션 @PostConstruct, @PreDestroy

- 가장 편하고 최신 스프링에서 권장하는 방법. 
- 초기화 메서드에 @PostConstruct를 지정하면 스프링 빈등록시 초기화 메서드로 수행된다.
- 소멸 메서드에 @PreDestroy애노테이션을 지정하면 소멸 메서드로 지정된다. 

- 애노테이션 하나만 붙히면 되기에 상당히 편하다.
- 해당 애노테이션의 import 패키지를 보면 javax.annotation.PostConstruct 이다. 즉 스프링에 종속적인 기술이 아닌 JSR-250 자바 표준이다. 
- 컴포넌트 스캔과 잘 어울린다.
- 하지만, 외부 라이브러리에는 적용하지 못하기에(변경 불가로 인해) 이런 경우에는 @Bean의 기능(속성을 부여)을 이용하면 된다. 
